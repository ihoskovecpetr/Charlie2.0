{"ast":null,"code":"import _slicedToArray from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  mutation cancelEvent($event_id: ID!) {\\n    cancelEvent(event_id: $event_id) {\\n      success\\n    }\\n  }\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useEffect,useContext,useState}from\"react\";import Button from\"@material-ui/core/Button\";import Grid from\"@material-ui/core/Grid\";import CloseIcon from'@material-ui/icons/Close';import HourglassEmptyIcon from'@material-ui/icons/HourglassEmpty';import Chip from'@material-ui/core/Chip';import{makeStyles}from\"@material-ui/core/styles\";import{withRouter,NavLink,useHistory}from\"react-router-dom\";import{useMutation,useQuery}from\"@apollo/react-hooks\";import gql from\"graphql-tag\";import{UserContext}from\"src/userContext\";import{ALL_EVENTS}from\"src/Services/GQL\";import{GET_ONE_EVENT}from\"src/Services/GQL/GET_ONE_EVENT\";import{PROFILE_DATA}from\"src/Services/GQL/PROFILE_DATA\";import{DELETE_BOOKING}from\"src/Services/GQL/DELETE_BOOKING\";import{EVENT_BOOKINGS}from\"src/Services/GQL/EVENT_BOOKINGS\";import{PLAY_EVENTS_QUERY}from\"src/Services/GQL/PLAY_EVENTS_QUERY\";import ModalRate from\"./ModalRate\";import JoinSend from\"src/Molecules/play/JoinSend\";var CANCEL_EVENT=gql(_templateObject());function EventButtons(_ref){var event=_ref.event,propContext=_ref.propContext;var classes=useStyles();var history=useHistory();var _useContext=useContext(UserContext),context=_useContext.context;var _useQuery=useQuery(EVENT_BOOKINGS,{variables:{event_id:event._id}}),loading=_useQuery.loading,data=_useQuery.data,error=_useQuery.error;var _useMutation=useMutation(DELETE_BOOKING),_useMutation2=_slicedToArray(_useMutation,2),deleteBooking=_useMutation2[0],deleteBookingStates=_useMutation2[1];var _useMutation3=useMutation(CANCEL_EVENT),_useMutation4=_slicedToArray(_useMutation3,2),cancelEvent=_useMutation4[0],cancelEventState=_useMutation4[1];var _useState=useState({}),_useState2=_slicedToArray(_useState,2),localContext=_useState2[0],setLocalContext=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),printComponents=_useState4[0],setPrintComponents=_useState4[1];var _useState5=useState({userIsAtt:null,userIsPend:null,userIsDecl:null,eventIsPast:null,userIsAuthor:null}),_useState6=_slicedToArray(_useState5,2),stateOfMyBooking=_useState6[0],setStateOfMyBooking=_useState6[1];console.log(\"RERENDER EVENTBTNS: \",propContext);useEffect(function(){if(propContext){setLocalContext(propContext);}else{setLocalContext(context);}},[context,propContext]);useEffect(function(){var userIsAtt=false;var userIsPend=false;var userIsDecl=false;var eventIsPast=false;var userIsAuthor=false;if(event.author._id===localContext._id){console.log(\"UserIsAuthor\");userIsAuthor=true;}if(event.dateEnd){var todayDate=new Date();var eventDate=new Date(event.dateEnd);if(todayDate<eventDate){console.log(\"EventIsFuture\");eventIsPast=false;}else{console.log(\"EventIsPast\");eventIsPast=true;}}if(data&&data.showBookings&&!userIsAuthor){// First filter only booking of current user\nvar filteredUserBooking=data.showBookings.filter(function(booking){return booking.user._id===localContext._id;});console.log(\"FILTERED BOOKING: \",filteredUserBooking);// First filter only booking of current user\nfilteredUserBooking.map(function(booking){console.log(\"JUDGEING THIS BOOKING: \",booking);if(!booking.confirmed&&!booking.cancelled&&!booking.decided){console.log(\"UserIsPending\");userIsPend=true;}if(booking.confirmed&&!booking.cancelled&&booking.decided){console.log(\"UserIsAtt\");userIsAtt=true;}if(!booking.confirmed&&!booking.cancelled&&booking.decided){console.log(\"UserIsDeclined\");userIsDecl=true;}});}console.log(\"StateOfMyBooking: Att, Pend, Decl, Past, Author \",userIsAtt,userIsPend,userIsDecl,eventIsPast,userIsAuthor);setStateOfMyBooking({userIsAtt:userIsAtt,userIsPend:userIsPend,userIsDecl:userIsDecl,eventIsPast:eventIsPast,userIsAuthor:userIsAuthor});},[event,event._id,data,localContext,data&&data.showBookings]);var alertCancelBooking=function alertCancelBooking(){var r=window.confirm(\"Are you sure you want to cancel this booking request?\");if(r==true){deleteBooking({variables:{user_id:localContext._id,event_id:event._id},refetchQueries:function refetchQueries(){return[{query:GET_ONE_EVENT,variables:{event_id:event._id}},{query:EVENT_BOOKINGS,variables:{event_id:event._id}},{query:ALL_EVENTS,variables:{date:new Date(event.dateStart).toISOString().split(\"T\")[0]}},{query:PROFILE_DATA,variables:{host_id:localContext._id}},{query:PLAY_EVENTS_QUERY,variables:{plusDays:localContext.playFilterObj.filterOn?localContext.playFilterObj.plusDays:10000,lng:localContext.playFilterObj.geolocationPlay?localContext.playFilterObj.geolocationPlay.lng:null,lat:localContext.playFilterObj.geolocationPlay?localContext.playFilterObj.geolocationPlay.lat:null,radius:localContext.playFilterObj.filterOn?localContext.playFilterObj.radius:9999999,shownEvents:localContext.playFilterObj.shownEvents}}];}});}else{return;}};var cancelEventHandle=function cancelEventHandle(){var r=window.confirm(\"Are you sure you want to calcel this event?\");if(r==true){cancelEvent({variables:{event_id:event._id},refetchQueries:function refetchQueries(){return[{query:ALL_EVENTS,variables:{date:new Date().toISOString()}//TODO..\n},{query:GET_ONE_EVENT,variables:{event_id:event._id}},{query:EVENT_BOOKINGS,variables:{event_id:event._id}}];}});}else{return;}};useEffect(function(){var ArrOfComponents=[];// ACTIVE EVENT\nif(event&&!event.hide&&event.author._id!=localContext._id&&localContext._id&&!stateOfMyBooking.eventIsPast&&!stateOfMyBooking.userIsDecl&&!stateOfMyBooking.userIsPend&&!stateOfMyBooking.userIsDeclined){ArrOfComponents.push(React.createElement(JoinSend,{event:event,localContext:localContext}));}// NO LOGED IN\nif(!localContext.name){ArrOfComponents.push(React.createElement(Chip,{label:\"LOGIN first\",icon:React.createElement(CloseIcon,null),color:\"secondary\",className:classes.chipOne,onClick:function onClick(){history.push(\"/signin\");}}));}// CANCELLED EVENT\nif(event&&event.hide){ArrOfComponents.push(React.createElement(Chip,{label:\"CANCELLED by author\",icon:React.createElement(CloseIcon,null),color:\"primary\",disabled:true,className:classes.chipOne}));}// USER DECLINED BY AUTHOR\nif(stateOfMyBooking.userIsDecl){ArrOfComponents.push(React.createElement(Chip,{label:\"You got DECLINED\",icon:React.createElement(CloseIcon,null),color:\"primary\",disabled:true,className:classes.chipOne}));}// PAST EVENT\nif(stateOfMyBooking.eventIsPast){ArrOfComponents.push(React.createElement(Chip,{label:\"PAST EVENT\",icon:React.createElement(CloseIcon,null),color:\"primary\",disabled:true,className:classes.chipOne}));}// USER is Pending\nif(localContext._id&&stateOfMyBooking.userIsPend){ArrOfComponents.push(React.createElement(Chip,{label:\"Pendining request\",icon:React.createElement(HourglassEmptyIcon,null),color:\"primary\",disabled:true,className:classes.chipOne}));}// USER is Declined\nif(localContext._id&&stateOfMyBooking.userIsDecl){ArrOfComponents.push(React.createElement(Chip,{label:\"Declined request\",icon:React.createElement(CloseIcon,null),color:\"primary\",disabled:true,className:classes.chipOne}));}// PAST EVENT RATE OR RATED\nif(localContext._id&&stateOfMyBooking.eventIsPast&&stateOfMyBooking.userIsAtt){ArrOfComponents.push(React.createElement(ModalRate,{event:event}));}if(localContext._id&&(stateOfMyBooking.userIsAtt||stateOfMyBooking.userIsPend)&&!stateOfMyBooking.eventIsPast){ArrOfComponents.push(React.createElement(Chip,{label:\"CANCEL your \".concat(stateOfMyBooking.userIsAtt?'attendance':'request'),icon:React.createElement(CloseIcon,null),color:\"secondary\",className:classes.chipOne,onClick:alertCancelBooking}));}// OWNER of active event\nif(!stateOfMyBooking.eventIsPast&&stateOfMyBooking.userIsAuthor&&!event.hide){ArrOfComponents.push(React.createElement(Chip,{label:\"CANCEL this event\",icon:React.createElement(CloseIcon,null),color:\"secondary\",className:classes.chipOne,onClick:cancelEventHandle}));}setPrintComponents(ArrOfComponents);},[event,stateOfMyBooking]);console.log(\"EventButtons stateOfMyBooking for event: \".concat(event.name,\" is:\"),stateOfMyBooking);return printComponents.map(function(item){return item;});}var useStyles=makeStyles(function(theme){return{buttonCls:{margin:10,width:\"50%\"},disabledBtn:{background:\"white !important\"},trueBtn:{width:\"100%\",height:60,borderRadius:0},chipOne:{width:\"90%\",fontWeight:500,fontSize:25,padding:5,margin:\"5%\"}};});export default EventButtons;","map":{"version":3,"sources":["/Users/petrhoskovec/Desktop/code/Charlie2.0/client/src/Molecules/event/EventButtons.js"],"names":["React","useEffect","useContext","useState","Button","Grid","CloseIcon","HourglassEmptyIcon","Chip","makeStyles","withRouter","NavLink","useHistory","useMutation","useQuery","gql","UserContext","ALL_EVENTS","GET_ONE_EVENT","PROFILE_DATA","DELETE_BOOKING","EVENT_BOOKINGS","PLAY_EVENTS_QUERY","ModalRate","JoinSend","CANCEL_EVENT","EventButtons","event","propContext","classes","useStyles","history","context","variables","event_id","_id","loading","data","error","deleteBooking","deleteBookingStates","cancelEvent","cancelEventState","localContext","setLocalContext","printComponents","setPrintComponents","userIsAtt","userIsPend","userIsDecl","eventIsPast","userIsAuthor","stateOfMyBooking","setStateOfMyBooking","console","log","author","dateEnd","todayDate","Date","eventDate","showBookings","filteredUserBooking","filter","booking","user","map","confirmed","cancelled","decided","alertCancelBooking","r","window","confirm","user_id","refetchQueries","query","date","dateStart","toISOString","split","host_id","plusDays","playFilterObj","filterOn","lng","geolocationPlay","lat","radius","shownEvents","cancelEventHandle","ArrOfComponents","hide","userIsDeclined","push","name","chipOne","item","theme","buttonCls","margin","width","disabledBtn","background","trueBtn","height","borderRadius","fontWeight","fontSize","padding"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext, useState } from \"react\";\nimport Button from \"@material-ui/core/Button\";\nimport Grid from \"@material-ui/core/Grid\";\nimport CloseIcon from '@material-ui/icons/Close';\nimport HourglassEmptyIcon from '@material-ui/icons/HourglassEmpty';\nimport Chip from '@material-ui/core/Chip';\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nimport { withRouter, NavLink, useHistory } from \"react-router-dom\";\nimport { useMutation, useQuery } from \"@apollo/react-hooks\";\nimport gql from \"graphql-tag\";\n\nimport { UserContext } from \"src/userContext\";\nimport { ALL_EVENTS } from \"src/Services/GQL\";\nimport { GET_ONE_EVENT } from \"src/Services/GQL/GET_ONE_EVENT\";\nimport { PROFILE_DATA } from \"src/Services/GQL/PROFILE_DATA\";\nimport { DELETE_BOOKING } from \"src/Services/GQL/DELETE_BOOKING\";\nimport { EVENT_BOOKINGS } from \"src/Services/GQL/EVENT_BOOKINGS\";\nimport { PLAY_EVENTS_QUERY } from \"src/Services/GQL/PLAY_EVENTS_QUERY\";\n\nimport ModalRate from \"./ModalRate\";\nimport JoinSend from \"src/Molecules/play/JoinSend\";\n\nconst CANCEL_EVENT = gql`\n  mutation cancelEvent($event_id: ID!) {\n    cancelEvent(event_id: $event_id) {\n      success\n    }\n  }\n`;\n\n\nfunction EventButtons({event, propContext}) {\n  const classes = useStyles();\n  let history = useHistory();\n  const { context } = useContext(UserContext);\n  const {loading, data, error} = useQuery(EVENT_BOOKINGS, {\n    variables: { event_id: event._id }\n  });\n  const [deleteBooking, deleteBookingStates] = useMutation(DELETE_BOOKING);\n  const [cancelEvent, cancelEventState] = useMutation(CANCEL_EVENT);\n  const [localContext, setLocalContext] = useState({});\n\n  const [printComponents, setPrintComponents] = useState([])\n\n  const [stateOfMyBooking, setStateOfMyBooking] = useState({\n    userIsAtt: null,\n    userIsPend: null,\n    userIsDecl: null,\n    eventIsPast: null,\n    userIsAuthor: null,\n  })\n\n  console.log(\"RERENDER EVENTBTNS: \", propContext)\n\n  useEffect(() => {\n    if(propContext){\n      setLocalContext(propContext)\n    }else{\n      setLocalContext(context)\n    }\n  },[context, propContext])\n\n\n  useEffect(() => {\n\n      let userIsAtt = false\n      let userIsPend = false\n      let userIsDecl = false\n      let eventIsPast = false\n      let userIsAuthor = false\n\n    if (event.author._id === localContext._id) {\n      console.log(\"UserIsAuthor\")\n      userIsAuthor = true\n    }\n\n    if (event.dateEnd) {\n      const todayDate = new Date();\n      const eventDate = new Date(event.dateEnd);\n\n      if (todayDate < eventDate) {\n        console.log(\"EventIsFuture\")\n        eventIsPast = false\n      } else {\n        console.log(\"EventIsPast\")\n        eventIsPast = true\n      }\n    }\n    \n    if (data && data.showBookings && !userIsAuthor) {\n      \n      // First filter only booking of current user\n      const filteredUserBooking = data.showBookings.filter(booking => booking.user._id === localContext._id)\n      console.log(\"FILTERED BOOKING: \", filteredUserBooking)\n      // First filter only booking of current user\n       filteredUserBooking.map(booking => {\n\n          console.log(\"JUDGEING THIS BOOKING: \", booking)\n\n          if (!booking.confirmed && !booking.cancelled && !booking.decided) {\n            console.log(\"UserIsPending\")\n            userIsPend = true\n          }\n\n          if (booking.confirmed && !booking.cancelled && booking.decided) {\n            console.log(\"UserIsAtt\")\n            userIsAtt = true\n          }\n\n          if (!booking.confirmed && !booking.cancelled && booking.decided) {\n            console.log(\"UserIsDeclined\")\n            userIsDecl = true\n          }\n      });\n    }\n\n    console.log(\"StateOfMyBooking: Att, Pend, Decl, Past, Author \", userIsAtt, userIsPend, userIsDecl, eventIsPast, userIsAuthor)\n\n    setStateOfMyBooking({\n      userIsAtt: userIsAtt,\n      userIsPend: userIsPend,\n      userIsDecl: userIsDecl,\n      eventIsPast: eventIsPast,\n      userIsAuthor: userIsAuthor\n    })\n\n  }, [event, event._id, data, localContext, data && data.showBookings]);\n\n  const alertCancelBooking = () => {\n    var r = window.confirm(\"Are you sure you want to cancel this booking request?\");\n    if (r == true) {\n      deleteBooking({\n      variables: {\n        user_id: localContext._id,\n        event_id: event._id\n      },\n      refetchQueries: () => [\n        {\n          query: GET_ONE_EVENT,\n          variables: { event_id: event._id }\n        },\n        {\n          query: EVENT_BOOKINGS,\n          variables: { event_id: event._id }\n        },\n        {\n          query: ALL_EVENTS,\n          variables: {\n            date: new Date(event.dateStart)\n              .toISOString()\n              .split(\"T\")[0]\n          }\n        },\n        {\n          query: PROFILE_DATA,\n          variables: { host_id: localContext._id }\n        },\n        {\n          query: PLAY_EVENTS_QUERY,\n          variables: {\n            plusDays: localContext.playFilterObj.filterOn ? localContext.playFilterObj.plusDays : 10000,\n            lng: localContext.playFilterObj.geolocationPlay ? localContext.playFilterObj.geolocationPlay.lng : null,\n            lat: localContext.playFilterObj.geolocationPlay ? localContext.playFilterObj.geolocationPlay.lat : null,\n            radius: localContext.playFilterObj.filterOn ? localContext.playFilterObj.radius : 9999999,\n            shownEvents: localContext.playFilterObj.shownEvents\n          }\n        }\n      ]\n    });\n    } else {\n      return\n    }\n  }\n\n  const cancelEventHandle = () => {\n    var r = window.confirm(\"Are you sure you want to calcel this event?\");\n    if (r == true) {\n    cancelEvent({\n      variables: {\n        event_id: event._id\n      },\n      refetchQueries: () => [\n        {\n          query: ALL_EVENTS,\n          variables: { date: new Date().toISOString() } //TODO..\n        },\n        {\n          query: GET_ONE_EVENT,\n          variables: { event_id: event._id }\n        },\n        {\n          query: EVENT_BOOKINGS,\n          variables: { event_id: event._id }\n        },\n      ]\n    });\n  }else{\n    return\n  }\n  }\n\n\nuseEffect(() => {\n\nconst ArrOfComponents = []\n  // ACTIVE EVENT\n  if(event && !event.hide && event.author._id != localContext._id \n    && localContext._id && !stateOfMyBooking.eventIsPast && !stateOfMyBooking.userIsDecl  \n    && !stateOfMyBooking.userIsPend && !stateOfMyBooking.userIsDeclined){\n    ArrOfComponents.push(\n     <JoinSend event={event} localContext={localContext}/>\n     )\n}\n\n  // NO LOGED IN\n  if (!localContext.name){\n    ArrOfComponents.push(\n      <Chip \n      label={`LOGIN first`} \n      icon={<CloseIcon />}\n      color=\"secondary\" \n      className={classes.chipOne} \n      onClick={() => { history.push(\"/signin\")}}\n      />\n    )\n\n  }\n  // CANCELLED EVENT\n  if (event && event.hide){\n    ArrOfComponents.push(\n        <Chip \n        label={`CANCELLED by author`} \n        icon={<CloseIcon />}\n        color=\"primary\" \n        disabled={true}\n        className={classes.chipOne} \n        />\n    )\n  }\n\n    // USER DECLINED BY AUTHOR\n    if (stateOfMyBooking.userIsDecl){\n      ArrOfComponents.push(\n          <Chip \n          label={`You got DECLINED`} \n          icon={<CloseIcon />}\n          color=\"primary\" \n          disabled={true}\n          className={classes.chipOne} \n          />\n      )\n    }\n\n  \n  // PAST EVENT\n  if (stateOfMyBooking.eventIsPast) {\n    ArrOfComponents.push(\n        <Chip \n        label={`PAST EVENT`} \n        icon={<CloseIcon />}\n        color=\"primary\" \n        disabled={true}\n        className={classes.chipOne} \n      />\n      )\n    }\n\n    // USER is Pending\n    if(localContext._id && stateOfMyBooking.userIsPend ){\n    ArrOfComponents.push(\n        <Chip \n        label={`Pendining request`} \n        icon={<HourglassEmptyIcon />}\n        color=\"primary\" \n        disabled={true}\n        className={classes.chipOne} \n      />\n      )\n    }\n\n        // USER is Declined\n        if(localContext._id && stateOfMyBooking.userIsDecl ){\n          ArrOfComponents.push(\n              <Chip \n              label={`Declined request`} \n              icon={<CloseIcon />}\n              color=\"primary\" \n              disabled={true}\n              className={classes.chipOne} \n            />\n            )\n          }\n\n// PAST EVENT RATE OR RATED\n  if (localContext._id && stateOfMyBooking.eventIsPast && stateOfMyBooking.userIsAtt) {\n    ArrOfComponents.push( \n      <ModalRate\n        event={event}\n      />\n            )\n    }\n\n    if(localContext._id && (stateOfMyBooking.userIsAtt || stateOfMyBooking.userIsPend) && !stateOfMyBooking.eventIsPast){\n      ArrOfComponents.push(\n      <Chip \n        label={`CANCEL your ${stateOfMyBooking.userIsAtt ? 'attendance' : 'request'}`} \n        icon={<CloseIcon />}\n        color=\"secondary\" \n        className={classes.chipOne} \n        onClick={alertCancelBooking}\n        />\n  )}\n\n  // OWNER of active event\n\n  if(!stateOfMyBooking.eventIsPast && stateOfMyBooking.userIsAuthor && !event.hide){\n    ArrOfComponents.push(\n      <Chip \n        label={`CANCEL this event`} \n        icon={<CloseIcon />}\n        color=\"secondary\" \n        className={classes.chipOne} \n        onClick={cancelEventHandle}\n        />\n     )\n}\nsetPrintComponents(ArrOfComponents)\n\n},[event, stateOfMyBooking ])\n\n\nconsole.log(`EventButtons stateOfMyBooking for event: ${event.name} is:`, stateOfMyBooking )\n  return printComponents.map(item => {\n    return item\n  })\n}\n\nconst useStyles = makeStyles(theme => ({\n  buttonCls: {\n    margin: 10,\n    width: \"50%\"\n  },\n  disabledBtn: {\n    background: \"white !important\"\n  },\n  trueBtn: {\n    width: \"100%\",\n    height: 60,\n    borderRadius: 0\n  },\n  chipOne: {\n    width: \"90%\", \n    fontWeight: 500, \n    fontSize: 25, \n    padding: 5, \n    margin: \"5%\"\n    },\n}));\n\nexport default EventButtons;\n"]},"metadata":{},"sourceType":"module"}