{"ast":null,"code":"import _slicedToArray from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/* eslint-disable no-undef */import ReactDOM from\"react-dom\";import React,{useContext,useState,useRef,useEffect,useMemo,useCallback}from\"react\";import{Switch,Route,BrowserRouter as Router}from\"react-router-dom\";import{ApolloClient,InMemoryCache,HttpLink,split,gql}from\"apollo-boost\";import{BatchHttpLink}from\"apollo-link-batch-http\";import{ApolloProvider}from\"@apollo/react-hooks\";import{WebSocketLink}from\"apollo-link-ws\";import{setContext}from\"apollo-link-context\";import{getMainDefinition}from\"apollo-utilities\";import{GeolocationMarker}from'geolocation-marker';import CssBaseline from\"@material-ui/core/CssBaseline\";import{makeStyles}from\"@material-ui/core/styles\";import\"date-fns\";import{useQuery}from\"@apollo/react-hooks\";import{useHistory}from\"react-router-dom\";import{UserContext}from\"src/userContext\";import mapSetup from\"../Services/map-settings\";import{ALL_EVENTS}from\"../Services/GQL\";import Map from\"../Atoms/MapAtom\";import InfoWindow from\"../Molecules/Infowindow\";import MapSettingsPanel from\"../Molecules/MapSettingsPanel\";import DrawerWrap from'src/Molecules/map/DrawerWrap';var infoBubble;var previousMarker;var AllMarkersArr;var MapObject;var GQL_ENDPOINT=\"http://localhost:4005/graphql\";if(process.env.NODE_ENV==\"production\"){GQL_ENDPOINT=\"https://\".concat(window.location.host,\"/graphql\");}var httpLink=new BatchHttpLink({uri:GQL_ENDPOINT,headers:{authorization:window.localStorage.getItem(\"token\")}});var WS_ENDPOINT=\"ws://localhost:4005/subs\";if(process.env.NODE_ENV==\"production\"){WS_ENDPOINT=\"wss://\".concat(window.location.host,\"/subs\");}var wsLink=new WebSocketLink({uri:WS_ENDPOINT,options:{reconnect:true}});var authLink=setContext(function(_,_ref){var headers=_ref.headers;// get the authentication token from local storage if it exists\nvar token=window.localStorage.getItem(\"token\");// return the headers to the context so httpLink can read them\nreturn{headers:_objectSpread({},headers,{authorization:\"Bearer \".concat(token)})};});var link=split(function(_ref2){var query=_ref2.query;var _getMainDefinition=getMainDefinition(query),kind=_getMainDefinition.kind,operation=_getMainDefinition.operation;return kind===\"OperationDefinition\"&&operation===\"subscription\";},wsLink,authLink.concat(httpLink));var client=new ApolloClient({link:link,cache:new InMemoryCache(),defaultOptions:{query:{fetchPolicy:\"network-only\",errorPolicy:\"all\"}}});function MapPage(props){var classes=useStyles();var history=useHistory();// const windowSize = useWindowSize()\nvar _useState=useState(0),_useState2=_slicedToArray(_useState,2),windowHeight=_useState2[0],setWindowHeight=_useState2[1];var _useState3=useState({center:props.workingPosition&&props.workingPosition.geometry?props.workingPosition.geometry:{lat:50.068645,lng:14.457364},// ,\nzoom:props.workingPosition&&props.workingPosition.zoom?props.workingPosition.zoom:10,disableDefaultUI:true,zoomControl:true,//mapTypeId: window.google.maps.MapTypeId.ROADMAP,\nclickableIcons:false,gestureHandling:\"cooperative\",backgroundColor:\"#242323\",styles:mapSetup}),_useState4=_slicedToArray(_useState3,2),mapOptions=_useState4[0],setMapOptions=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),openDrawer=_useState6[0],setOpenDrawer=_useState6[1];var _useContext=useContext(UserContext),context=_useContext.context,setContext=_useContext.setContext;var _useQuery=useQuery(ALL_EVENTS,{variables:{date:props.workingPosition&&props.workingPosition.date?props.workingPosition.date:new Date().toISOString().split(\"T\")[0],offset:1,limit:1},fetchPolicy:\"cache-and-network\"}),loading=_useQuery.loading,error=_useQuery.error,data=_useQuery.data,fetchMore=_useQuery.fetchMore;console.log(\"RERENDER MAP PAGE: openDrawer\",openDrawer);useEffect(function(){// if (!window.AppHistory) {\n//   window.AppHistory = history;\n// }\nconsole.log(\"Map.js rerendering\");setWindowHeight(window.innerHeight);},[]);var clearMarkers=function clearMarkers(){for(var i=0;i<AllMarkersArr.length;i++){AllMarkersArr[i].setMap(null);}};var redirectLogin=function redirectLogin(){history.push(\"/signin\");};if(error){alert(\"Unable to load Events...\");}var handleScrollLocTime=function handleScrollLocTime(isoDate){var center=MapObject.getCenter();console.log(\"Setting Working Position from hndleScroll\",center.lng());props.setWorkingPosition(function(prev){return _objectSpread({},prev,{geometry:{lng:center.lng(),lat:center.lat()},zoom:MapObject.getZoom(),date:isoDate});});};var onMapMount=useCallback(function(map){var uniqueArrayOfId=[];var UniqArr=[];// let dataDB;\nconsole.log(\"Map Mounted:: \",google);// declare var google;\nMapObject=map;var GeoMarker=new window.GeolocationMarker(map);if(data&&data.eventGeoDay){for(var i=0;i<data.eventGeoDay.length;i++){if(uniqueArrayOfId.indexOf(data.eventGeoDay[i]._id)==-1&&data.eventGeoDay[i].confirmed==true){uniqueArrayOfId.push(data.eventGeoDay[i]._id);UniqArr.push(data.eventGeoDay[i]);}}}map.addListener(\"idle\",function(){console.log(\"Mapa Idle map: \",map);var bounds=map.getBounds();var center=map.getCenter();//   //console.log(\"ZOOOM1: \", bounds);\n//   //console.log(\"ZOOOM2: \", bounds.getNorthEast());\n//   //var ne = bounds.getNorthEast();\n//   //var sw = bounds.getSouthWest();\n//   //console.log(\"ne, \", ne);\n//   // console.log(sw)\n//   // console.log(JSON.stringify(ne.lng()), JSON.stringify(ne.lat()), JSON.stringify(sw.lng()) , JSON.stringify(sw.lat()))\n//   //  var ne1 = new Number(JSON.stringify(ne.lng()))\n//   //  var ne2 = new Number(JSON.stringify(ne.lat()))\n//   //  var sw1 = new Number(JSON.stringify(sw.lng()))\n//   //  var sw2 = new Number(JSON.stringify(sw.lat()))\n//   // var newPoly0 = [[sw1, sw2], [ne1, sw2], [ne1, ne2], [sw1, ne2]]\n//   // var newPoly = [[sw1, sw2], [ne1, sw2], [ne1, ne2], [sw1, -33.8]]\n//   // var newPoly2 = [[sw1, sw2], [ne1, sw2], [ne1, ne2], [sw1, -33.9]]\n//   // console.log(\"newPoly\", newPoly)\n//   // var SumPolyWork = SumPoly\n//   // console.log(\"...SumPolyWork\")\n//   // console.log(...SumPolyWork)\n//   // SumPoly = polygon.union(...SumPolyWork , POLY_A);\n//   // console.log(\"SumPoly\", SumPoly)\n//   //console.log(\"Setting current: \");\n//   //   if(props.workingPosition.zoom != map.getZoom() || props.workingPosition.geolocation.lat != center.lat()){\nconsole.log(\"Set new Idle zoom: \",center.lat(),center.lng());//  if(center){\n//     props.setWorkingPosition(prev => {return({\n//       ...prev,\n//       geolocation: { lat: center.lat(), lng: center.lng() },\n//       zoom: map.getZoom()\n//     })});\n//  }\n//   //   }\n//   //here.fetchBoundariesSingle(ne,sw)\n//   //console.log(\"Fetch points BoarDERS?\");\n});map.addListener(\"click\",function(event){// here.setState({confirmedPressed: false})\nif(previousMarker){infoBubble.close();setTimeout(function(){if(document.getElementById(\"infoWindow\")){ReactDOM.unmountComponentAtNode(document.getElementById(\"infoWindow\"));}},10);//infoBubble.setMap(null);\npreviousMarker=undefined;}});infoBubble=new window.InfoBubble({content:\"<div id=\\\"infoWindow\\\"> </div>\",shadowStyle:1,padding:0,backgroundColor:\"#242323\",borderRadius:0,arrowSize:10,borderWidth:0,borderColor:\"#ffffff\",disableAutoPan:true,hideCloseButton:true,arrowPosition:50,backgroundClassName:\"nonused\",enableEventPropagation:false,arrowStyle:0,minWidth:200,minHeight:160});{if(!loading){AllMarkersArr=UniqArr.map(function(location,i){var urlNA=\"https://res.cloudinary.com/party-images-app/image/upload/v1583692669/ijy8dorejsarudzkauma.png\";// {BasicMarker}\nvar urlAttend=\"https://res.cloudinary.com/party-images-app/image/upload/v1583692624/nwvqlicffptzqpwha5no.png\";// {CharlieMarker} \nvar url=urlNA;location.bookings&&location.bookings.map(function(guest,index){//console.log(\"User indexOf: \", guest.user._id, user._id);\n// if (guest.user._id == context._id) {\n//   //console.log(\"Yes, GUEST\");\n//   {\n//     !guest.cancelled && guest.confirmed && (url = urlAttend);\n//   }\n// } else {\n//   //console.log(\"No, GUEST\");\n// }\n// if (here.props.email.indexOf(guest.guest_email) !== -1 && guest.guest_confirmed == true) {\n//   url = urlAttend\n// }\n});var image={url:url,size:new window.google.maps.Size(48,48),origin:new window.google.maps.Point(0,0),anchor:new window.google.maps.Point(24,48),scaledSize:new window.google.maps.Size(48,48)};var marker=new window.google.maps.Marker({position:{lat:location.geometry.coordinates[1],lng:location.geometry.coordinates[0]},map:map,icon:image,// animation: window.google.maps.Animation.DROP,\ntitle:location.name});marker.addListener(\"click\",function(){console.log(\"Marker Click\",infoBubble);if(previousMarker){infoBubble.close();previousMarker=undefined;}else{infoBubble.addListener(\"domready\",function(e){setTimeout(function(){ReactDOM.render(React.createElement(React.Fragment,null,React.createElement(ApolloProvider,{client:client},React.createElement(UserContext.Provider,{value:function value(){}},React.createElement(Router,null,React.createElement(DrawerWrap,{open:true,event:location,context:context,setContext:setContext})))),React.createElement(InfoWindow,{lat:location.geometry.coordinates[0],lng:location.geometry.coordinates[1],id:location._id,location:location,context:context,setContext:setContext,setOpenDrawer:setOpenDrawer,openDrawer:openDrawer,redirectLogin:redirectLogin})),document.getElementById(\"infoWindow\"));},100);});infoBubble.open(map,marker);previousMarker=location;}});return marker;});}}});useEffect(function(){console.log(\"Context Map Geo rewrite from actual!!\");if(context.geolocationObj&&!props.workingPosition.geolocation){console.log(\"Settig LngLat from CONTEXT  \",context.geolocationObj);setMapOptions(function(prev){return _objectSpread({},prev,{center:context.geolocationObj});});}},[context.geolocationObj]);useEffect(function(){console.log(\"props.workingPosition: \",props.workingPosition);if(props.workingPosition&&props.workingPosition.geometry){console.log(\"Settig lngLat prop.workingLoc \",props.workingPosition);setMapOptions(function(prev){return _objectSpread({},prev,{center:props.workingPosition.geometry});});}},[props.workingPosition]);var MapAtom=useMemo(function(){return React.createElement(\"div\",{style:{width:\"100%\",height:\"\".concat(1*windowHeight,\"px\"),top:0,position:\"absolute\",background:\"black\"}},React.createElement(Map,{onMount:onMapMount,options:mapOptions,className:\"main-map\",styling:{width:\"100%\",position:'absolute',height:\"\".concat(1*windowHeight,\"px\"),top:0,bottom:0}}));},[onMapMount,mapOptions]);return React.createElement(\"div\",{component:\"main\",className:classes.container},React.createElement(CssBaseline,null),React.createElement(MapSettingsPanel//dateState={workDate}\n,{dateState:props.workingPosition&&props.workingPosition.date?props.workingPosition.date:0,positionState:props.workingPosition&&props.workingPosition.geometry,setWorkDate:props.setWorkingPosition,handleScrollLocTime:handleScrollLocTime,clearMarkers:clearMarkers,loading:loading}),MapAtom);}var useStyles=makeStyles(function(theme){return{paper:{marginTop:theme.spacing(2),display:\"flex\",flexDirection:\"column\",alignItems:\"center\"},container:{padding:0},avatar:{margin:theme.spacing(1),backgroundColor:theme.palette.secondary.main},form:{width:\"100%\",// Fix IE 11 issue.\nmarginTop:theme.spacing(1)},submit:{margin:theme.spacing(3,0,2)},backdrop:{zIndex:theme.zIndex.drawer+1,color:'#fff'}};});export default MapPage;","map":{"version":3,"sources":["/Users/petrhoskovec/Desktop/code/Charlie2.0/client/src/Pages/MapPage.js"],"names":["ReactDOM","React","useContext","useState","useRef","useEffect","useMemo","useCallback","Switch","Route","BrowserRouter","Router","ApolloClient","InMemoryCache","HttpLink","split","gql","BatchHttpLink","ApolloProvider","WebSocketLink","setContext","getMainDefinition","GeolocationMarker","CssBaseline","makeStyles","useQuery","useHistory","UserContext","mapSetup","ALL_EVENTS","Map","InfoWindow","MapSettingsPanel","DrawerWrap","infoBubble","previousMarker","AllMarkersArr","MapObject","GQL_ENDPOINT","process","env","NODE_ENV","window","location","host","httpLink","uri","headers","authorization","localStorage","getItem","WS_ENDPOINT","wsLink","options","reconnect","authLink","_","token","link","query","kind","operation","concat","client","cache","defaultOptions","fetchPolicy","errorPolicy","MapPage","props","classes","useStyles","history","windowHeight","setWindowHeight","center","workingPosition","geometry","lat","lng","zoom","disableDefaultUI","zoomControl","clickableIcons","gestureHandling","backgroundColor","styles","mapOptions","setMapOptions","openDrawer","setOpenDrawer","context","variables","date","Date","toISOString","offset","limit","loading","error","data","fetchMore","console","log","innerHeight","clearMarkers","i","length","setMap","redirectLogin","push","alert","handleScrollLocTime","isoDate","getCenter","setWorkingPosition","prev","getZoom","onMapMount","map","uniqueArrayOfId","UniqArr","google","GeoMarker","eventGeoDay","indexOf","_id","confirmed","addListener","bounds","getBounds","event","close","setTimeout","document","getElementById","unmountComponentAtNode","undefined","InfoBubble","content","shadowStyle","padding","borderRadius","arrowSize","borderWidth","borderColor","disableAutoPan","hideCloseButton","arrowPosition","backgroundClassName","enableEventPropagation","arrowStyle","minWidth","minHeight","urlNA","urlAttend","url","bookings","guest","index","image","size","maps","Size","origin","Point","anchor","scaledSize","marker","Marker","position","coordinates","icon","title","name","e","render","open","geolocationObj","geolocation","MapAtom","width","height","top","background","bottom","container","theme","paper","marginTop","spacing","display","flexDirection","alignItems","avatar","margin","palette","secondary","main","form","submit","backdrop","zIndex","drawer","color"],"mappings":"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","sourcesContent":["/* eslint-disable no-undef */\nimport ReactDOM from \"react-dom\";\nimport React, {\n  useContext,\n  useState,\n  useRef,\n  useEffect,\n  useMemo,\n  useCallback\n} from \"react\";\nimport { Switch, Route, BrowserRouter as Router } from \"react-router-dom\";\nimport {\n  ApolloClient,\n  InMemoryCache,\n  HttpLink,\n  split,\n  gql\n} from \"apollo-boost\";\nimport { BatchHttpLink } from \"apollo-link-batch-http\";\nimport { ApolloProvider } from \"@apollo/react-hooks\";\nimport { WebSocketLink } from \"apollo-link-ws\";\nimport { setContext } from \"apollo-link-context\";\nimport { getMainDefinition } from \"apollo-utilities\";\nimport { GeolocationMarker } from 'geolocation-marker'\n\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nimport \"date-fns\";\nimport { useQuery } from \"@apollo/react-hooks\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { UserContext } from \"src/userContext\";\nimport mapSetup from \"../Services/map-settings\";\nimport { ALL_EVENTS } from \"../Services/GQL\";\n\nimport Map from \"../Atoms/MapAtom\";\nimport InfoWindow from \"../Molecules/Infowindow\";\nimport MapSettingsPanel from \"../Molecules/MapSettingsPanel\";\nimport DrawerWrap from 'src/Molecules/map/DrawerWrap';\n\nlet infoBubble;\nlet previousMarker;\nlet AllMarkersArr;\nlet MapObject;\n\n\nvar GQL_ENDPOINT = `http://localhost:4005/graphql`;\nif (process.env.NODE_ENV == \"production\") {\n  GQL_ENDPOINT = `https://${window.location.host}/graphql`;\n}\nconst httpLink = new BatchHttpLink({\n  uri: GQL_ENDPOINT,\n  headers: {\n    authorization: window.localStorage.getItem(\"token\")\n  }\n});\n\nvar WS_ENDPOINT = `ws://localhost:4005/subs`;\nif (process.env.NODE_ENV == \"production\") {\n  WS_ENDPOINT = `wss://${window.location.host}/subs`;\n}\n\nconst wsLink = new WebSocketLink({\n  uri: WS_ENDPOINT,\n  options: {\n    reconnect: true\n  }\n});\n\nconst authLink = setContext((_, { headers }) => {\n  // get the authentication token from local storage if it exists\n  const token = window.localStorage.getItem(\"token\");\n  // return the headers to the context so httpLink can read them\n  return {\n    headers: {\n      ...headers,\n      authorization: `Bearer ${token}`\n    }\n  };\n});\n\nconst link = split(\n  ({ query }) => {\n    const { kind, operation } = getMainDefinition(query);\n    return kind === \"OperationDefinition\" && operation === \"subscription\";\n  },\n  wsLink,\n  authLink.concat(httpLink)\n);\n\nconst client = new ApolloClient({\n  link,\n  cache: new InMemoryCache(),\n  defaultOptions: {\n    query: {\n      fetchPolicy: \"network-only\",\n      errorPolicy: \"all\"\n    }\n  }\n});\n\nfunction MapPage(props) {\n  const classes = useStyles();\n  let history = useHistory();\n  // const windowSize = useWindowSize()\n  const [windowHeight, setWindowHeight] = useState(0);\n  const [mapOptions, setMapOptions] = useState({\n                                          center: props.workingPosition && props.workingPosition.geometry ? props.workingPosition.geometry : { lat: 50.068645, lng: 14.457364 },// ,\n                                          zoom: props.workingPosition && props.workingPosition.zoom ? props.workingPosition.zoom : 10,\n                                          disableDefaultUI: true,\n                                          zoomControl: true,\n                                          //mapTypeId: window.google.maps.MapTypeId.ROADMAP,\n                                          clickableIcons: false,\n                                          gestureHandling: \"cooperative\",\n                                          backgroundColor: \"#242323\",\n                                          styles: mapSetup\n                                        });\n  const [openDrawer, setOpenDrawer] = useState(false)\n  const { context, setContext } = useContext(UserContext);\n  const { loading, error, data, fetchMore } = useQuery(ALL_EVENTS, {\n    variables: {  date: props.workingPosition && props.workingPosition.date ? props.workingPosition.date : new Date().toISOString().split(\"T\")[0], \n                  offset: 1,\n                  limit: 1 \n              },\n      fetchPolicy: \"cache-and-network\"\n  });\n\n  console.log(\"RERENDER MAP PAGE: openDrawer\", openDrawer)\n\n\n  useEffect(() => {\n    // if (!window.AppHistory) {\n    //   window.AppHistory = history;\n    // }\n    console.log(\"Map.js rerendering\")\n    setWindowHeight(window.innerHeight)\n  }, []);\n\n\n  const clearMarkers = () => {\n    for (let i = 0; i < AllMarkersArr.length; i++) {\n      AllMarkersArr[i].setMap(null);\n    }\n  };\n\n  const redirectLogin = () => {\n    history.push(\"/signin\");\n  };\n\n  if (error) {\n    alert(\"Unable to load Events...\");\n  }\n\n  const handleScrollLocTime = isoDate => {\n    let center = MapObject.getCenter();\n    console.log(\"Setting Working Position from hndleScroll\", center.lng())\n    props.setWorkingPosition(prev => {return({\n      ...prev,\n      geometry: { lng: center.lng(), lat: center.lat() },\n      zoom: MapObject.getZoom(),\n      date: isoDate\n      })\n    });\n  };\n\n  const onMapMount = useCallback(map => {\n    let uniqueArrayOfId = [];\n    let UniqArr = [];\n    // let dataDB;\n    console.log(\"Map Mounted:: \", google);\n    // declare var google;\n    MapObject = map;\n\n    var GeoMarker = new window.GeolocationMarker(map);\n\n    if (data && data.eventGeoDay) {\n      for (var i = 0; i < data.eventGeoDay.length; i++) {\n        if (\n          uniqueArrayOfId.indexOf(data.eventGeoDay[i]._id) == -1 &&\n          data.eventGeoDay[i].confirmed == true\n        ) {\n          uniqueArrayOfId.push(data.eventGeoDay[i]._id);\n          UniqArr.push(data.eventGeoDay[i]);\n        }\n      }\n    }\n\n    map.addListener(\"idle\", function() {\n      console.log(\"Mapa Idle map: \", map)\n      var bounds = map.getBounds();\n      var center = map.getCenter();\n\n    //   //console.log(\"ZOOOM1: \", bounds);\n    //   //console.log(\"ZOOOM2: \", bounds.getNorthEast());\n    //   //var ne = bounds.getNorthEast();\n    //   //var sw = bounds.getSouthWest();\n    //   //console.log(\"ne, \", ne);\n    //   // console.log(sw)\n    //   // console.log(JSON.stringify(ne.lng()), JSON.stringify(ne.lat()), JSON.stringify(sw.lng()) , JSON.stringify(sw.lat()))\n    //   //  var ne1 = new Number(JSON.stringify(ne.lng()))\n    //   //  var ne2 = new Number(JSON.stringify(ne.lat()))\n    //   //  var sw1 = new Number(JSON.stringify(sw.lng()))\n    //   //  var sw2 = new Number(JSON.stringify(sw.lat()))\n\n    //   // var newPoly0 = [[sw1, sw2], [ne1, sw2], [ne1, ne2], [sw1, ne2]]\n    //   // var newPoly = [[sw1, sw2], [ne1, sw2], [ne1, ne2], [sw1, -33.8]]\n    //   // var newPoly2 = [[sw1, sw2], [ne1, sw2], [ne1, ne2], [sw1, -33.9]]\n    //   // console.log(\"newPoly\", newPoly)\n\n    //   // var SumPolyWork = SumPoly\n\n    //   // console.log(\"...SumPolyWork\")\n    //   // console.log(...SumPolyWork)\n\n    //   // SumPoly = polygon.union(...SumPolyWork , POLY_A);\n    //   // console.log(\"SumPoly\", SumPoly)\n    //   //console.log(\"Setting current: \");\n\n    //   //   if(props.workingPosition.zoom != map.getZoom() || props.workingPosition.geolocation.lat != center.lat()){\n         console.log(\"Set new Idle zoom: \", center.lat(), center.lng())\n        //  if(center){\n        //     props.setWorkingPosition(prev => {return({\n        //       ...prev,\n        //       geolocation: { lat: center.lat(), lng: center.lng() },\n        //       zoom: map.getZoom()\n        //     })});\n        //  }\n\n    //   //   }\n\n\n\n\n    //   //here.fetchBoundariesSingle(ne,sw)\n    //   //console.log(\"Fetch points BoarDERS?\");\n    });\n\n    map.addListener(\"click\", function(event) {\n\n      // here.setState({confirmedPressed: false})\n      if (previousMarker) {\n        infoBubble.close();\n        setTimeout(() => {\n          if (document.getElementById(\"infoWindow\")) {\n            ReactDOM.unmountComponentAtNode(\n              document.getElementById(\"infoWindow\")\n            );\n          }\n        }, 10);\n        //infoBubble.setMap(null);\n        previousMarker = undefined;\n      }\n    });\n\n    infoBubble = new window.InfoBubble({\n      content: `<div id=\"infoWindow\"> </div>`,\n      shadowStyle: 1,\n      padding: 0,\n      backgroundColor: \"#242323\",\n      borderRadius: 0,\n      arrowSize: 10,\n      borderWidth: 0,\n      borderColor: \"#ffffff\",\n      disableAutoPan: true,\n      hideCloseButton: true,\n      arrowPosition: 50,\n      backgroundClassName: \"nonused\",\n      enableEventPropagation: false,\n      arrowStyle: 0,\n      minWidth: 200,\n      minHeight: 160\n    });\n    {\n      if (!loading) {\n        AllMarkersArr = UniqArr.map((location, i) => {\n          var urlNA = \"https://res.cloudinary.com/party-images-app/image/upload/v1583692669/ijy8dorejsarudzkauma.png\" // {BasicMarker}\n          var urlAttend = \"https://res.cloudinary.com/party-images-app/image/upload/v1583692624/nwvqlicffptzqpwha5no.png\" // {CharlieMarker} \n          var url = urlNA;\n\n          location.bookings &&\n            location.bookings.map((guest, index) => {\n              //console.log(\"User indexOf: \", guest.user._id, user._id);\n              // if (guest.user._id == context._id) {\n              //   //console.log(\"Yes, GUEST\");\n              //   {\n              //     !guest.cancelled && guest.confirmed && (url = urlAttend);\n              //   }\n              // } else {\n              //   //console.log(\"No, GUEST\");\n              // }\n              // if (here.props.email.indexOf(guest.guest_email) !== -1 && guest.guest_confirmed == true) {\n              //   url = urlAttend\n              // }\n            });\n          var image = {\n            url: url,\n            size: new window.google.maps.Size(48, 48),\n            origin: new window.google.maps.Point(0, 0),\n            anchor: new window.google.maps.Point(24, 48),\n            scaledSize: new window.google.maps.Size(48, 48)\n          };\n\n          var marker = new window.google.maps.Marker({\n            position: {\n              lat: location.geometry.coordinates[1],\n              lng: location.geometry.coordinates[0]\n            },\n            map: map,\n            icon: image,\n            // animation: window.google.maps.Animation.DROP,\n            title: location.name\n          });\n\n          marker.addListener(\"click\", function() {\n            console.log(\"Marker Click\", infoBubble)\n\n            if (previousMarker) {\n              infoBubble.close()\n              previousMarker = undefined\n            } else{\n            infoBubble.addListener(\"domready\", e => {\n                setTimeout(() => {\n                ReactDOM.render(\n                  <>\n                  <ApolloProvider client={client}>\n                    <UserContext.Provider value={() => {}} >\n                      <Router>\n                        <DrawerWrap open={true} event={location} context={context} setContext={setContext} />\n                      </Router>\n                    </UserContext.Provider>\n                  </ApolloProvider>\n                  <InfoWindow\n                      lat={location.geometry.coordinates[0]}\n                      lng={location.geometry.coordinates[1]}\n                      id={location._id}\n                      location={location}\n                      context={context}\n                      setContext={setContext}\n                      setOpenDrawer={setOpenDrawer}\n                      openDrawer={openDrawer}\n                      redirectLogin={redirectLogin} />\n                  </>\n                  ,\n                  document.getElementById(\"infoWindow\")\n                );\n              }, 100);\n            });\n            infoBubble.open(map, marker);\n            previousMarker = location\n          }\n          });\n\n          return marker;\n        });\n      }\n    }\n  });\n\n  useEffect(() => {\n    \n    console.log(\"Context Map Geo rewrite from actual!!\")\n    if (context.geolocationObj && !props.workingPosition.geolocation) {\n      console.log(\"Settig LngLat from CONTEXT  \", context.geolocationObj)\n\n      setMapOptions(prev => {\n        return({\n          ...prev,\n          center: context.geolocationObj\n        })\n      })\n    }\n  }, [context.geolocationObj])\n\n  useEffect(() => {\n    console.log(\"props.workingPosition: \", props.workingPosition)\n    if (props.workingPosition && props.workingPosition.geometry) {\n      console.log(\"Settig lngLat prop.workingLoc \", props.workingPosition)\n\n      setMapOptions(prev => {\n        return({\n          ...prev,\n          center: props.workingPosition.geometry\n        })\n      })\n    }\n  }, [props.workingPosition])\n\n\n\n  const MapAtom = useMemo(\n    () => (\n      <div style={{ \n            width: \"100%\",\n            height: `${1*windowHeight}px`,\n            top: 0,\n            position: \"absolute\",\n            background: \"black\"\n            }}>\n      <Map\n        onMount={onMapMount}\n        options={mapOptions}\n        className=\"main-map\"\n        styling={{\n          width: \"100%\", \n          position: 'absolute', \n          height: `${1*windowHeight}px`,\n          top: 0,\n          bottom: 0}}\n      />\n      </div>\n    ),\n    [onMapMount, mapOptions]\n  );\n\n\n  return (\n    <div component=\"main\" className={classes.container}>\n      <CssBaseline />\n      <MapSettingsPanel\n        //dateState={workDate}\n        dateState={props.workingPosition && props.workingPosition.date ? props.workingPosition.date : 0}\n        positionState={props.workingPosition && props.workingPosition.geometry}\n        setWorkDate={props.setWorkingPosition}\n        handleScrollLocTime={handleScrollLocTime}\n        clearMarkers={clearMarkers}\n        loading={loading}\n      />\n      {MapAtom}\n    </div>\n  );\n}\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    marginTop: theme.spacing(2),\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\"\n  },\n  container: {\n    padding: 0\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main\n  },\n  form: {\n    width: \"100%\", // Fix IE 11 issue.\n    marginTop: theme.spacing(1)\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2)\n  },\n  backdrop: {\n    zIndex: theme.zIndex.drawer + 1,\n    color: '#fff',\n  },\n}));\n\nexport default MapPage;\n"]},"metadata":{},"sourceType":"module"}