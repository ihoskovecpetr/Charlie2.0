{"ast":null,"code":"import _defineProperty from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\nmutation loginExternal(\\n        $email: String!,\\n        $id: String!\\n      ){\\n        loginExternal(email: $email, id: $id) {\\n            dataOut{\\n                success\\n                _id\\n                name\\n                email\\n                description\\n                picture\\n                token\\n                typeSocial\\n                typeDirect\\n                }\\n            errorOut{\\n                  name\\n                  message\\n                }\\n        }\\n      }\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect,useContext}from\"react\";import Grid from\"@material-ui/core/Grid\";import Button from\"@material-ui/core/Button\";import FacebookLogin from\"react-facebook-login\";import GoogleLogin from'react-google-login';import{useHistory}from\"react-router-dom\";import gql from\"graphql-tag\";import{useMutation}from\"@apollo/react-hooks\";import{makeStyles}from\"@material-ui/core/styles\";import{UserContext}from\"src/userContext\";import{NEW_USER}from\"src/Services/GQL/NEW_USER\";import{UPDATE_USER}from\"src/Services/GQL/UPDATE_USER\";import Spinner from\"src/Atoms/Spinner\";export var LOGINEXTERNAL=gql(_templateObject());export default function SocialLogins(){var classes=useStyles();var _useState=useState(),_useState2=_slicedToArray(_useState,2),extUser=_useState2[0],setExtUser=_useState2[1];var _useContext=useContext(UserContext),context=_useContext.context,setContext=_useContext.setContext;var _useMutation=useMutation(LOGINEXTERNAL),_useMutation2=_slicedToArray(_useMutation,2),loginExt=_useMutation2[0],_useMutation2$=_useMutation2[1],loading=_useMutation2$.loading,error=_useMutation2$.error,data=_useMutation2$.data;var _useMutation3=useMutation(NEW_USER),_useMutation4=_slicedToArray(_useMutation3,2),newUser=_useMutation4[0],newUserStates=_useMutation4[1];var _useMutation5=useMutation(UPDATE_USER),_useMutation6=_slicedToArray(_useMutation5,2),updateUser=_useMutation6[0],updateUserStates=_useMutation6[1];var history=useHistory();var GoogleV='https://res.cloudinary.com/party-images-app/image/upload/v1557462915/vgvduspc6s8j368y1ras.png';//If I got fbc User, lets login and get all user data\nuseEffect(function(){if(extUser){loginExt({variables:{email:extUser.email,id:extUser.id}});}},[extUser]);//After fbc aproval, login or make new user\nuseEffect(function(){if(data&&data.loginExternal&&data.loginExternal.dataOut){if(data.loginExternal.dataOut.success===false){newUser({variables:{name:extUser.name,email:extUser.email,password:\"FAKE_FAKE\",socialId:extUser.id,description:\"Hi, I am \".concat(extUser.name),picture:extUser.picture,typeSocial:true,typeDirect:false}});}if(data.loginExternal.dataOut.success){//user already existed, just find out if it was already social or not yes\nif(data.loginExternal.dataOut.typeSocial){window.localStorage.setItem(\"token\",data.loginExternal.dataOut.token);setContext(function(prev){return _objectSpread({},prev,{_id:data.loginExternal.dataOut._id,success:data.loginExternal.dataOut.success,name:data.loginExternal.dataOut.name,email:data.loginExternal.dataOut.email,picture:data.loginExternal.dataOut.picture,description:data.loginExternal.dataOut.description,token:data.loginExternal.dataOut.token});});}else{updateUser({variables:{_id:data.loginExternal.dataOut._id,socialId:extUser.id,description:data.loginExternal.dataOut.description,name:data.loginExternal.dataOut.name,picture:data.loginExternal.dataOut.picture,typeSocial:true,typeDirect:data.loginExternal.dataOut.typeDirect}});//set user info without doublechecking how update went (for now, TODO: later) \nwindow.localStorage.setItem(\"token\",data.loginExternal.dataOut.token);setContext(function(prev){return _objectSpread({},prev,{_id:data.loginExternal.dataOut._id,success:data.loginExternal.dataOut.success,name:data.loginExternal.dataOut.name,email:data.loginExternal.dataOut.email,picture:data.loginExternal.dataOut.picture,description:data.loginExternal.dataOut.description,token:data.loginExternal.dataOut.token});});}// context.setUserToContext(data.loginExternal.dataOut)\n}}},[data&&data.loginExternal]);//Login after creating new user\nuseEffect(function(){console.log(\"NSW finished new user: \",newUserStates);if(newUserStates&&newUserStates.data&&newUserStates.data.newUser&&newUserStates.data.newUser.dataOut){if(newUserStates.data.newUser.dataOut.success){console.log(\"Setting new user automaticaly when sign in for first tine from fcb/google\");setContext(function(prev){return _objectSpread({},prev,{_id:newUserStates.data.newUser.dataOut._id,success:newUserStates.data.newUser.dataOut.success,name:newUserStates.data.newUser.dataOut.name,email:newUserStates.data.newUser.dataOut.email,picture:newUserStates.data.newUser.dataOut.picture,description:newUserStates.data.newUser.dataOut.description,token:newUserStates.data.newUser.dataOut.token});});}}},[newUserStates]);useEffect(function(){if(context._id){history.goBack();}},[context._id]);var responseExternal=function responseExternal(response,type){console.log(\"FB GG response \",type,response);switch(type){case\"fb\":if(response.id){setExtUser({name:response.name,email:response.email,id:response.id,picture:response.picture.data.url});}break;case\"gg\":if(response.profileObj&&response.profileObj.googleId){setExtUser({email:response.profileObj.email,name:response.profileObj.name,picture:response.profileObj.imageUrl,id:response.profileObj.googleId});}break;default:// code block\n}};var fbContent;fbContent=React.createElement(Grid,{container:true,className:classes.mainContainer},React.createElement(Grid,{item:true,xs:12,className:classes.spinnerWrapGrid},newUserStates&&newUserStates.loading?React.createElement(Grid,{container:true,justify:\"center\",className:classes.spinnerWrapGridBackdrop},React.createElement(Grid,{item:true},React.createElement(Spinner,{height:80,width:80}))):'',loading?React.createElement(Grid,{container:true,justify:\"center\",className:classes.spinnerWrapGridBackdrop},React.createElement(Grid,{item:true},React.createElement(Spinner,{height:80,width:80}))):\"\"),React.createElement(Grid,{item:true,xs:12,className:classes.itemFacebook},React.createElement(Grid,{container:true,justify:\"center\"},React.createElement(Grid,{item:true},React.createElement(FacebookLogin,{appId:\"601460357134288\",autoLoad:false,fields:\"name,email,picture\",scope:\"public_profile,email\",size:\"metro\",redirectUri:\"https://www.charliehouseparty.club/\",disableMobileRedirect:true,isMobile:true,className:classes.buttonFacebook,callback:function callback(e){return responseExternal(e,\"fb\");}})))),React.createElement(Grid,{item:true,xs:12,className:classes.itemGoogle},React.createElement(GoogleLogin,{clientId:\"119981354324-7sj8o5l3dk03s56paf6d4fd0fbr9vuu6.apps.googleusercontent.com\",render:function render(renderProps){return React.createElement(Button,{variant:\"contained\",className:classes.googleBtn,onClick:renderProps.onClick,disabled:renderProps.disabled},React.createElement(Grid,{container:true,alignItems:\"center\",justify:\"center\"},React.createElement(Grid,{item:true},React.createElement(Grid,{container:true,alignItems:\"center\",alignContent:\"center\",justify:\"center\"},React.createElement(Grid,{item:true},React.createElement(\"img\",{className:classes.iconGoogle,src:GoogleV})),React.createElement(Grid,{item:true},React.createElement(\"p\",{className:classes.googleBtnText},\"Login with GOOGLE\"))))));},buttonText:\"Login\",onSuccess:function onSuccess(e){return responseExternal(e,\"gg\");},onFailure:function onFailure(e){return responseExternal(e,\"gg\");},cookiePolicy:'single_host_origin'})));return React.createElement(\"div\",null,fbContent);}var useStyles=makeStyles(function(theme){return{mainContainer:{width:'100%',minHeight:100},spinnerWrapGrid:{height:0,zIndex:100},spinnerWrapGridBackdrop:{height:128,width:'100%',backgroundColor:'rgba(255,255,255,0.4)'},iconGoogle:{height:20,width:20,marginRight:10},googleBtn:{width:'100%'},googleBtnText:{marginTop:3,marginBottom:3},itemFacebook:{backgroundColor:'#4c69ba',marginTop:10,marginBottom:10},itemGoogle:{marginBottom:10},buttonFacebook:{width:'100%'}};});","map":{"version":3,"sources":["/Users/petrhoskovec/Desktop/code/Charlie2.0/client/src/Atoms/SignIn/SocialLogins.js"],"names":["React","useState","useEffect","useContext","Grid","Button","FacebookLogin","GoogleLogin","useHistory","gql","useMutation","makeStyles","UserContext","NEW_USER","UPDATE_USER","Spinner","LOGINEXTERNAL","SocialLogins","classes","useStyles","extUser","setExtUser","context","setContext","loginExt","loading","error","data","newUser","newUserStates","updateUser","updateUserStates","history","GoogleV","variables","email","id","loginExternal","dataOut","success","name","password","socialId","description","picture","typeSocial","typeDirect","window","localStorage","setItem","token","prev","_id","console","log","goBack","responseExternal","response","type","url","profileObj","googleId","imageUrl","fbContent","mainContainer","spinnerWrapGrid","spinnerWrapGridBackdrop","itemFacebook","buttonFacebook","e","itemGoogle","renderProps","googleBtn","onClick","disabled","iconGoogle","googleBtnText","theme","width","minHeight","height","zIndex","backgroundColor","marginRight","marginTop","marginBottom"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useContext} from \"react\"\nimport Grid from \"@material-ui/core/Grid\";\nimport Button from \"@material-ui/core/Button\";\n\nimport FacebookLogin from \"react-facebook-login\"\nimport GoogleLogin from 'react-google-login';\nimport { useHistory } from \"react-router-dom\";\nimport gql from \"graphql-tag\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nimport { UserContext } from \"src/userContext\";\nimport { NEW_USER } from \"src/Services/GQL/NEW_USER\"\nimport { UPDATE_USER } from \"src/Services/GQL/UPDATE_USER\"\n\nimport Spinner from \"src/Atoms/Spinner\";\n\nexport const LOGINEXTERNAL = gql`\nmutation loginExternal(\n        $email: String!,\n        $id: String!\n      ){\n        loginExternal(email: $email, id: $id) {\n            dataOut{\n                success\n                _id\n                name\n                email\n                description\n                picture\n                token\n                typeSocial\n                typeDirect\n                }\n            errorOut{\n                  name\n                  message\n                }\n        }\n      }\n`;\n\nexport default function SocialLogins(){\n    const classes = useStyles();\n    const [extUser, setExtUser] = useState()\n    const { context, setContext } = useContext(UserContext);\n    const [loginExt, { loading, error, data }] = useMutation(LOGINEXTERNAL);\n    const [newUser, newUserStates] = useMutation(NEW_USER);\n    const [updateUser, updateUserStates] = useMutation(UPDATE_USER)\n    let history = useHistory();\n    var GoogleV = 'https://res.cloudinary.com/party-images-app/image/upload/v1557462915/vgvduspc6s8j368y1ras.png'\n\n//If I got fbc User, lets login and get all user data\n    useEffect(() => {\n      if(extUser){\n        loginExt({\n          variables: {\n            email: extUser.email,\n            id: extUser.id\n          }\n        });\n      }\n  }, [extUser])\n\n  //After fbc aproval, login or make new user\n    useEffect(() => {\n        if(data && data.loginExternal && data.loginExternal.dataOut){\n          if(data.loginExternal.dataOut.success === false){\n            newUser({\n            variables: {\n              name:  extUser.name,\n              email:  extUser.email,\n              password: \"FAKE_FAKE\",\n              socialId: extUser.id,\n              description: `Hi, I am ${extUser.name}`,\n              picture: extUser.picture,\n              typeSocial: true,\n              typeDirect: false, \n            }\n          })\n          }\n          if(data.loginExternal.dataOut.success){\n            //user already existed, just find out if it was already social or not yes\n            if(data.loginExternal.dataOut.typeSocial){\n              window.localStorage.setItem(\"token\", data.loginExternal.dataOut.token);\n              setContext(prev => {\n                return({\n                  ...prev,\n                  _id: data.loginExternal.dataOut._id,\n                  success: data.loginExternal.dataOut.success,\n                  name: data.loginExternal.dataOut.name,\n                  email: data.loginExternal.dataOut.email,\n                  picture: data.loginExternal.dataOut.picture,\n                  description: data.loginExternal.dataOut.description,\n                  token: data.loginExternal.dataOut.token\n                })\n              })\n            }else{\n              updateUser({\n                variables: {\n                  _id: data.loginExternal.dataOut._id,\n                  socialId: extUser.id,\n                  description: data.loginExternal.dataOut.description,\n                  name: data.loginExternal.dataOut.name,\n                  picture: data.loginExternal.dataOut.picture,\n                  typeSocial: true,\n                  typeDirect: data.loginExternal.dataOut.typeDirect\n                },\n              })\n              //set user info without doublechecking how update went (for now, TODO: later) \n              window.localStorage.setItem(\"token\", data.loginExternal.dataOut.token);\n              setContext(prev => {\n                return({\n                  ...prev,\n                  _id: data.loginExternal.dataOut._id,\n                  success: data.loginExternal.dataOut.success,\n                  name: data.loginExternal.dataOut.name,\n                  email: data.loginExternal.dataOut.email,\n                  picture: data.loginExternal.dataOut.picture,\n                  description: data.loginExternal.dataOut.description,\n                  token: data.loginExternal.dataOut.token\n                })\n              })\n\n            }\n\n            // context.setUserToContext(data.loginExternal.dataOut)\n          }\n\n        }\n    }, [data && data.loginExternal])\n\n  //Login after creating new user\n  useEffect(() => {\n    console.log(\"NSW finished new user: \", newUserStates)\n    if(newUserStates && newUserStates.data && newUserStates.data.newUser && newUserStates.data.newUser.dataOut){\n      if(newUserStates.data.newUser.dataOut.success){\n        console.log(\"Setting new user automaticaly when sign in for first tine from fcb/google\")\n        setContext(prev => {\n          return({\n            ...prev,\n            _id: newUserStates.data.newUser.dataOut._id,\n            success: newUserStates.data.newUser.dataOut.success,\n            name: newUserStates.data.newUser.dataOut.name,\n            email: newUserStates.data.newUser.dataOut.email,\n            picture: newUserStates.data.newUser.dataOut.picture,\n            description: newUserStates.data.newUser.dataOut.description,\n            token: newUserStates.data.newUser.dataOut.token\n          })\n        })\n      } \n    }\n\n  }, [newUserStates])\n\n  useEffect(() => {\n    if(context._id){\n      history.goBack();\n    }\n  }, [context._id])\n\n    const responseExternal = (response, type) => {\n        console.log(\"FB GG response \", type, response)\n\n        switch(type) {\n          case \"fb\":\n            if(response.id){\n              setExtUser({\n                name: response.name,\n                email: response.email,\n                id: response.id,\n                picture: response.picture.data.url\n              })\n            }\n            break;\n          case \"gg\":\n            if(response.profileObj && response.profileObj.googleId){\n              setExtUser({\n                email: response.profileObj.email,\n                name: response.profileObj.name,\n                picture: response.profileObj.imageUrl,\n                id: response.profileObj.googleId})\n            }\n            break;\n          default:\n            // code block\n        }\n  }\n\n\n\n    let fbContent;\n\n        fbContent = (<Grid container className={classes.mainContainer}>\n\n          <Grid item xs={12} className={classes.spinnerWrapGrid}>\n          {newUserStates && newUserStates.loading ?\n            <Grid container justify=\"center\" className={classes.spinnerWrapGridBackdrop}> \n              <Grid item>\n                <Spinner height={80} width={80} />\n              </Grid>\n            </Grid> \n            : ''}\n            {loading ? \n            <Grid container justify=\"center\" className={classes.spinnerWrapGridBackdrop}> \n              <Grid item >\n                <Spinner height={80} width={80} />\n              </Grid>\n            </Grid>\n            : \"\"}\n\n          </Grid>\n\n          <Grid item xs={12} className={classes.itemFacebook}>\n            <Grid container justify=\"center\">\n              <Grid item>\n                  <FacebookLogin\n                        appId=\"601460357134288\"\n                        autoLoad={false}\n                        fields=\"name,email,picture\"\n                        scope=\"public_profile,email\"\n                        size=\"metro\"\n                        redirectUri=\"https://www.charliehouseparty.club/\"\n                        disableMobileRedirect={true}\n                        isMobile={true}\n                        className={classes.buttonFacebook}\n                        callback={(e) => responseExternal(e, \"fb\")}\n                      />\n              </Grid>\n            </Grid>\n          </Grid>\n          <Grid item xs={12} className={classes.itemGoogle}>\n            {/* <Grid container justify=\"center\">\n              <Grid item> */}\n              <GoogleLogin\n                    clientId=\"119981354324-7sj8o5l3dk03s56paf6d4fd0fbr9vuu6.apps.googleusercontent.com\"\n                    render={renderProps => (\n                      <Button variant=\"contained\" className={classes.googleBtn} onClick={renderProps.onClick} disabled={renderProps.disabled}>\n                        <Grid container alignItems=\"center\" justify=\"center\">\n                          <Grid item>\n                          <Grid container alignItems=\"center\" alignContent=\"center\" justify=\"center\">\n                            <Grid item>\n                              <img className={classes.iconGoogle} src={GoogleV} />\n                            </Grid>\n                            <Grid item>\n                              <p className={classes.googleBtnText}>Login with GOOGLE</p>\n                            </Grid>\n                          </Grid>\n                          </Grid>\n                        </Grid>\n                      </Button>\n                    )}\n                    buttonText=\"Login\"\n                    onSuccess={(e) => responseExternal(e, \"gg\")}\n                    onFailure={(e) => responseExternal(e, \"gg\")}\n                    cookiePolicy={'single_host_origin'}\n                  />\n              {/* </Grid>\n            </Grid> */}\n          </Grid>\n        </Grid>)\n\n    return (\n      <div>\n      {fbContent}\n      </div>\n    );\n}\n\nconst useStyles = makeStyles(theme => ({\n  mainContainer: {\n    width: '100%',\n    minHeight: 100,\n  },\n  spinnerWrapGrid: {\n    height: 0,\n    zIndex: 100\n  },\n  spinnerWrapGridBackdrop: {\n    height: 128,\n    width: '100%',\n    backgroundColor: 'rgba(255,255,255,0.4)'\n  },\n  iconGoogle: {\n    height: 20,\n    width: 20,\n    marginRight: 10\n  },\n  googleBtn:{\n    width: '100%',\n  },\n  googleBtnText:{\n    marginTop: 3,\n    marginBottom: 3\n  },\n  itemFacebook: {\n    backgroundColor: '#4c69ba',\n    marginTop: 10,\n    marginBottom: 10,\n  },\n  itemGoogle: {\n    marginBottom: 10\n  },\n  buttonFacebook: {\n    width: '100%'\n  }\n}));"]},"metadata":{},"sourceType":"module"}