{"ast":null,"code":"import _defineProperty from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/petrhoskovec/Desktop/code/Charlie2.0/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  mutation requestBookEvent(\\n    $event_id: String!\\n    $guest_id: String!\\n    $guest_name: String!\\n    $message: String!\\n  ) {\\n    requestBookEvent(\\n      event_id: $event_id\\n      guest_id: $guest_id\\n      guest_name: $guest_name\\n      message: $message\\n    ) {\\n      _id\\n      success\\n      message\\n    }\\n  }\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useRef,useEffect}from\"react\";import Grid from\"@material-ui/core/Grid\";import Chip from'@material-ui/core/Chip';import{makeStyles,useTheme}from\"@material-ui/core/styles\";import TextField from\"@material-ui/core/TextField\";import InputLabel from\"@material-ui/core/InputLabel\";import DoneIcon from'@material-ui/icons/Done';import CloseIcon from'@material-ui/icons/Close';import HourglassEmptyIcon from'@material-ui/icons/HourglassEmpty';import WhatshotIcon from'@material-ui/icons/Whatshot';import SendIcon from'@material-ui/icons/Send';import CheckCircleOutlineIcon from'@material-ui/icons/CheckCircleOutline';import clsx from\"clsx\";import{useMutation}from\"@apollo/react-hooks\";import gql from\"graphql-tag\";import{useHistory}from\"react-router-dom\";import{Animated}from\"react-animated-css\";import{PROFILE_DATA}from\"src/Services/GQL/PROFILE_DATA\";import{GET_ONE_EVENT}from\"src/Services/GQL/GET_ONE_EVENT\";import{EVENT_BOOKINGS}from\"src/Services/GQL/EVENT_BOOKINGS\";import{PLAY_EVENTS_QUERY}from\"src/Services/GQL/PLAY_EVENTS_QUERY\";import Spinner from\"../../Atoms/Spinner\";var BOOKING_REQ=gql(_templateObject());export default function JoinSend(_ref){var event=_ref.event,localContext=_ref.localContext;var classes=useStyles();var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),checked=_useState2[0],setChecked=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),sending=_useState4[0],setSending=_useState4[1];// const [refetched, setRefetched] = useState(false);\nvar _useState5=useState({message:\"JOIN\",pending:false,attending:false,icon:[React.createElement(WhatshotIcon,{fontSize:\"large\"})]}),_useState6=_slicedToArray(_useState5,2),localState=_useState6[0],setLocalState=_useState6[1];var _useMutation=useMutation(BOOKING_REQ),_useMutation2=_slicedToArray(_useMutation,2),createReqBooking=_useMutation2[0],_useMutation2$=_useMutation2[1],loading=_useMutation2$.loading,error=_useMutation2$.error,data=_useMutation2$.data;var inputDescription=useRef(null);console.log(\"JOIN SEND RERENDER\");useEffect(function(){event&&event.bookings&&event.bookings.map(function(item){if(item.user._id===localContext._id){if(item.decided&&item.confirmed){// attending = true\n// icon = [<DoneIcon fontSize=\"large\" />]\nsetLocalState(function(prev){{return _objectSpread({},prev,{message:\"Attending\",attending:true,icon:[React.createElement(DoneIcon,{fontSize:\"large\"})]});}});}}});},[event,event.bookings,localContext._id]);function openJoin(){if(!localState.attending&&!localState.pending){setChecked(true);setTimeout(function(){window.scrollBy({top:200,left:0,behavior:'smooth'});},100);setTimeout(function(){document.getElementById(\"bottomAnchor\").scrollIntoView();},400);}}function sendBooking(params){setLocalState(function(prev){return _objectSpread({},prev,{message:\"Sending\",attending:true,icon:[React.createElement(HourglassEmptyIcon,{fontSize:\"large\"})]});});createReqBooking({variables:{guest_id:localContext._id,guest_name:localContext.name,event_id:event._id,message:inputDescription.current.value?inputDescription.current.value:null},refetchQueries:function refetchQueries(){return[{query:PROFILE_DATA,variables:{host_id:localContext._id}},{query:GET_ONE_EVENT,variables:{event_id:history.location.pathname.split(\"/\")[2]}},{query:EVENT_BOOKINGS,variables:{event_id:event._id}},{query:PLAY_EVENTS_QUERY,variables:{plusDays:localContext.playFilterObj.filterOn?localContext.playFilterObj.plusDays:10000,lng:localContext.playFilterObj.geolocationPlay?localContext.playFilterObj.geolocationPlay.lng:null,lat:localContext.playFilterObj.geolocationPlay?localContext.playFilterObj.geolocationPlay.lat:null,radius:localContext.playFilterObj.filterOn?localContext.playFilterObj.radius:9999999,shownEvents:localContext.playFilterObj.shownEvents}}];}});setChecked(false);}if(event.areYouAuthor)return React.createElement(\"p\",{className:classes.textAuthor},\" You are author of this event \");return React.createElement(React.Fragment,null,React.createElement(Chip,{label:\"\".concat(localState.message)// icon={attending && <DoneIcon fontSize=\"large\" />}\n,icon:localState.icon[0]//variant=\"outlined\" \n,color:\"secondary\",className:classes.chipOne,onClick:openJoin,disabled:checked||localState.attending||localState.pending}),React.createElement(Grid,{container:true,className:clsx(classes.sendJoinContainer,checked&&classes.openSend),alignItems:\"center\"},!loading&&!data&&React.createElement(Grid,{item:true,xs:12,className:clsx(classes.itemSend,checked&&classes.displayBlock)},React.createElement(Animated,{animationIn:\"fadeIn\",animationOut:\"fadeOut\",animationInDelay:500//animationInDuration={5000}\n,isVisible:true,infinite:true},React.createElement(InputLabel,{htmlFor:\"standard-adornment-amount\"},\"YOUR MESSAGE\"),React.createElement(TextField,{variant:\"outlined\",margin:\"normal\",required:true,fullWidth:true,defaultValue:\"Hi, let me please come and have a great experience :)\",multiline:true,rows:\"4\",color:\"primary\",inputRef:inputDescription,name:\"decsription\",autoComplete:\"false\",className:classes.textField}),React.createElement(Chip,{label:\"SEND\",color:\"secondary\",icon:React.createElement(SendIcon,{fontSize:\"large\"}),className:classes.chipSend,onClick:sendBooking})),React.createElement(\"div\",{id:\"bottomAnchor\"})),loading&&React.createElement(Grid,{container:true,justify:\"center\",alignItems:\"center\",className:classes.loadingGridCont},React.createElement(Grid,{item:true},React.createElement(Spinner,{height:100,width:100}))),!loading&&data&&data.requestBookEvent&&React.createElement(Grid,{item:true,xs:12,className:clsx(classes.itemSend,checked&&classes.displayBlock)},React.createElement(InputLabel,{htmlFor:\"standard-adornment-amount\"},\"Finished\"))));}var useStyles=makeStyles(function(theme){return{sendJoinContainer:{backgroundColor:\"white\",height:0,overflow:'hidden',transition:'height 0.6s',transitionTimingFunction:'ease-out'},openSend:{display:\"block\",height:248,padding:10},textAuthor:{textAlign:\"center\"},itemSend:{display:\"none\"},displayBlock:{display:\"block\"},chipOne:{width:\"90%\",fontWeight:500,fontSize:25,padding:20,margin:\"5%\"},chipSend:{width:\"90%\",fontWeight:500,fontSize:25,padding:20,margin:\"5%\"}};});","map":{"version":3,"sources":["/Users/petrhoskovec/Desktop/code/Charlie2.0/client/src/Molecules/play/JoinSend.js"],"names":["React","useState","useRef","useEffect","Grid","Chip","makeStyles","useTheme","TextField","InputLabel","DoneIcon","CloseIcon","HourglassEmptyIcon","WhatshotIcon","SendIcon","CheckCircleOutlineIcon","clsx","useMutation","gql","useHistory","Animated","PROFILE_DATA","GET_ONE_EVENT","EVENT_BOOKINGS","PLAY_EVENTS_QUERY","Spinner","BOOKING_REQ","JoinSend","event","localContext","classes","useStyles","history","checked","setChecked","sending","setSending","message","pending","attending","icon","localState","setLocalState","createReqBooking","loading","error","data","inputDescription","console","log","bookings","map","item","user","_id","decided","confirmed","prev","openJoin","setTimeout","window","scrollBy","top","left","behavior","document","getElementById","scrollIntoView","sendBooking","params","variables","guest_id","guest_name","name","event_id","current","value","refetchQueries","query","host_id","location","pathname","split","plusDays","playFilterObj","filterOn","lng","geolocationPlay","lat","radius","shownEvents","areYouAuthor","textAuthor","chipOne","sendJoinContainer","openSend","itemSend","displayBlock","textField","chipSend","loadingGridCont","requestBookEvent","theme","backgroundColor","height","overflow","transition","transitionTimingFunction","display","padding","textAlign","width","fontWeight","fontSize","margin"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Chip from '@material-ui/core/Chip';\nimport { makeStyles, useTheme } from \"@material-ui/core/styles\";\nimport TextField from \"@material-ui/core/TextField\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport DoneIcon from '@material-ui/icons/Done';\nimport CloseIcon from '@material-ui/icons/Close';\nimport HourglassEmptyIcon from '@material-ui/icons/HourglassEmpty';\nimport WhatshotIcon from '@material-ui/icons/Whatshot';\nimport SendIcon from '@material-ui/icons/Send';\nimport CheckCircleOutlineIcon from '@material-ui/icons/CheckCircleOutline';\n\nimport clsx from \"clsx\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport gql from \"graphql-tag\";\nimport { useHistory } from \"react-router-dom\";\nimport { Animated } from \"react-animated-css\";\n\nimport { PROFILE_DATA } from \"src/Services/GQL/PROFILE_DATA\";\nimport { GET_ONE_EVENT } from \"src/Services/GQL/GET_ONE_EVENT\";\nimport { EVENT_BOOKINGS } from \"src/Services/GQL/EVENT_BOOKINGS\";\nimport { PLAY_EVENTS_QUERY } from \"src/Services/GQL/PLAY_EVENTS_QUERY\";\n\nimport Spinner from \"../../Atoms/Spinner\";\n\n\nconst BOOKING_REQ = gql`\n  mutation requestBookEvent(\n    $event_id: String!\n    $guest_id: String!\n    $guest_name: String!\n    $message: String!\n  ) {\n    requestBookEvent(\n      event_id: $event_id\n      guest_id: $guest_id\n      guest_name: $guest_name\n      message: $message\n    ) {\n      _id\n      success\n      message\n    }\n  }\n`;\n\nexport default function JoinSend({event, localContext}) {\n    const classes = useStyles();\n    let history = useHistory();\n    const [checked, setChecked] = useState(false);\n    const [sending, setSending] = useState(false);\n    // const [refetched, setRefetched] = useState(false);\n\n    const [localState, setLocalState] = useState({\n      message: \"JOIN\",\n      pending: false,\n      attending: false,\n      icon: [<WhatshotIcon fontSize=\"large\" />]\n    });\n    const [createReqBooking,  { loading, error, data }] = useMutation(BOOKING_REQ);\n\n    const inputDescription = useRef(null);\n\n    console.log(\"JOIN SEND RERENDER\")\n    useEffect(() => {\n\n      event && event.bookings && event.bookings.map(item => {\n        if( item.user._id === localContext._id) {\n            if(item.decided && item.confirmed){\n                // attending = true\n                // icon = [<DoneIcon fontSize=\"large\" />]\n                setLocalState(prev => {\n                  {\n                    return { \n                      ...prev, \n                      message: \"Attending\",\n                    attending: true,\n                    icon: [<DoneIcon fontSize=\"large\" />]\n                   };\n                  }\n                })\n            }\n        }\n    })\n\n    }, [event, event.bookings, localContext._id])\n\n    function openJoin(){\n      if(!localState.attending && !localState.pending){\n        setChecked(true)\n        setTimeout(() => { \n          window.scrollBy({\n          top: 200,\n          left: 0,\n          behavior: 'smooth'\n        }); }, 100);\n        setTimeout(() => { \n          document.getElementById(\"bottomAnchor\").scrollIntoView();\n        }, 400);\n      }\n    }\n\n    function sendBooking(params) {\n      setLocalState(prev => ({ \n            ...prev, \n            message: \"Sending\",\n            attending: true,\n            icon: [<HourglassEmptyIcon fontSize=\"large\" />]\n      }))\n        createReqBooking({\n            variables: {\n              guest_id: localContext._id,\n              guest_name: localContext.name,\n              event_id: event._id,\n              message: inputDescription.current.value\n                        ? inputDescription.current.value\n                        : null,\n            },\n            refetchQueries: () => [\n              {\n                query: PROFILE_DATA,\n                variables: { host_id: localContext._id }\n              },\n              {\n                query: GET_ONE_EVENT,\n                variables: { event_id: history.location.pathname.split(\"/\")[2]}\n              },\n              {\n                query: EVENT_BOOKINGS,\n                variables: { event_id: event._id }\n              },\n              {\n                query: PLAY_EVENTS_QUERY,\n                variables: {\n                  plusDays: localContext.playFilterObj.filterOn ? localContext.playFilterObj.plusDays : 10000,\n                  lng: localContext.playFilterObj.geolocationPlay ? localContext.playFilterObj.geolocationPlay.lng : null,\n                  lat: localContext.playFilterObj.geolocationPlay ? localContext.playFilterObj.geolocationPlay.lat : null,\n                  radius: localContext.playFilterObj.filterOn ? localContext.playFilterObj.radius : 9999999,\n                  shownEvents: localContext.playFilterObj.shownEvents\n                }\n              }\n            ]\n          })\n          setChecked(false)\n    }\n\n    if(event.areYouAuthor) return <p className={classes.textAuthor}> You are author of this event </p>\n\n    return (\n        <>\n        <Chip \n        label={`${localState.message}`} \n        // icon={attending && <DoneIcon fontSize=\"large\" />}\n        icon={localState.icon[0]}\n        //variant=\"outlined\" \n        color=\"secondary\" \n        className={classes.chipOne} \n        onClick={openJoin}\n        disabled={checked || localState.attending || localState.pending}\n        />\n        <Grid container\n            className={clsx(classes.sendJoinContainer, checked && classes.openSend, )}\n            alignItems=\"center\">\n            {!loading && !data && (\n            <Grid item xs={12} className={clsx(classes.itemSend, checked && classes.displayBlock)}>\n            <Animated\n              animationIn=\"fadeIn\"\n              animationOut=\"fadeOut\"\n              animationInDelay={500}\n              //animationInDuration={5000}\n              isVisible={true}\n              infinite={true}\n            >\n                <InputLabel htmlFor=\"standard-adornment-amount\">\n                    YOUR MESSAGE\n                </InputLabel>\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"normal\"\n                    required\n                    fullWidth\n                    defaultValue=\"Hi, let me please come and have a great experience :)\"\n                    multiline\n                    rows=\"4\"\n                    color=\"primary\"\n                    inputRef={inputDescription}\n                    name=\"decsription\"\n                    autoComplete=\"false\"\n                    className={classes.textField}\n                    />\n                    <Chip label={`SEND`} \n                        color=\"secondary\" \n                        icon={<SendIcon fontSize=\"large\" />}\n                        className={classes.chipSend}\n                        onClick={sendBooking}\n                        />\n                </Animated>\n                <div id=\"bottomAnchor\"></div>\n            </Grid>\n            )}\n            {loading && (\n              <Grid container justify=\"center\" alignItems='center' className={classes.loadingGridCont}>\n                <Grid item>\n                  <Spinner height={100} width={100} />\n                </Grid>\n              </Grid>\n            )}\n            \n            {!loading && data && data.requestBookEvent && (\n            <Grid item xs={12} className={clsx(classes.itemSend, checked && classes.displayBlock)}>\n                <InputLabel htmlFor=\"standard-adornment-amount\">\n                    Finished\n                </InputLabel>\n                \n            </Grid>\n            )}\n        </Grid>\n    </>\n    )\n}\n\n\nconst useStyles = makeStyles(theme => ({\n   \n    sendJoinContainer: {\n      backgroundColor: \"white\",\n      height: 0,\n      overflow: 'hidden',\n      transition: 'height 0.6s',\n      transitionTimingFunction: 'ease-out',\n    },\n    openSend: {\n      display: \"block\",\n      height: 248,\n      padding: 10,\n    },\n    textAuthor:{\n      textAlign: \"center\"\n    },\n    itemSend: {\n        display: \"none\",\n      },\n    displayBlock: {\n        display: \"block\",\n      },\n    chipOne: {\n      width: \"90%\", \n      fontWeight: 500, \n      fontSize: 25, \n      padding: 20, \n      margin: \"5%\"\n      },\n    chipSend: {\n      width: \"90%\", \n      fontWeight: 500, \n      fontSize: 25, \n      padding: 20, \n      margin: \"5%\" \n    }\n  \n  }));"]},"metadata":{},"sourceType":"module"}